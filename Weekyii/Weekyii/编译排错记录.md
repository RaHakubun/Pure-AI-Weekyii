# 编译排错记录（Weekyii iOS）

> 用于记录编译过程中出现的错误、原因与解决方式，作为后续开发警示。

## 1) Info.plist 重复输出
**报错**
- duplicate output file ... Info.plist

**原因**
- 工程同时启用了自动生成 Info.plist + 手动加入 `Resources/Info.plist`

**解决**
- 保留自动生成 Info.plist
- 移除 `Resources/Info.plist` 的 Target Membership

---

## 2) Localizable.xcstrings 缺少 version
**报错**
- Missing required key 'version'

**原因**
- xcstrings 文件缺少必需字段

**解决**
- 增加：`"version" : "1.0"`

---

## 3) XCTest 被加入主 Target
**报错**
- Unable to find module dependency: 'XCTest'

**原因**
- Tests 目录下的测试文件被编译进主 App Target

**解决**
- 将 `Tests/*.swift` 从 App Target 的 Sources 中移除

---

## 4) Combine 未导入
**报错**
- autoconnect() is not available due to missing import Combine

**原因**
- 使用 `Timer.publish(...).autoconnect()` 但未 import Combine

**解决**
- 在 `WeekyiiApp.swift` 增加 `import Combine`

---

## 5) SwiftData Predicate + enum case 报错
**报错**
- key path cannot refer to enum case 'present'

**原因**
- `#Predicate` 在该版本中不支持直接比较 enum case

**解决**
- 改为先 fetch 全部，再内存 filter
- 影响文件：
  - `Features/Week/WeekViewModel.swift`
  - `Features/Today/TodayViewModel.swift`
  - `Features/Pending/PendingViewModel.swift`
  - `Features/Past/PastViewModel.swift`
  - `Services/StateMachine.swift`

---

## 6) 缺少 AppIcon / AccentColor
**报错**
- None of the input catalogs contained a matching app icon set named "AppIcon"

**原因**
- Asset Catalog 中没有 AppIcon / AccentColor

**解决**
- 增加：
  - `Resources/Assets.xcassets/AppIcon.appiconset`
  - `Resources/Assets.xcassets/AccentColor.colorset`

---

## 7) Primary 颜色名冲突
**报错**
- "Primary" color asset name resolves to a conflicting Color symbol "primary"

**原因**
- 资源名与系统 `Color.primary` 冲突

**解决**
- 重命名为 `PrimaryBrand.colorset`
- `Color+Weekyii.swift` 改为 `Color("PrimaryBrand")`

---

## 8) MainActor 隔离警告
**报错**
- TimeProvider / NotificationService 作为默认参数在非主线程初始化

**原因**
- Swift 并发推断导致的 main actor 警告

**解决**
- 取消默认参数，改为显式注入
- 调用处明确传入 `TimeProvider()` / `.shared`

---

## 9) AppIcon iOS Marketing 警告
**报错**
- A 1024x1024 app store icon is required

**原因**
- `Contents.json` 中 1024 图标 idiom 写错

**解决**
- 将 1024 图标 entry 改为 `"idiom": "ios-marketing"`

---

## 结论
- 编译最终成功（iPhone 17 Pro / iOS 26.2）。
- 以上问题均已修复，可作为后续开发的排错手册。
